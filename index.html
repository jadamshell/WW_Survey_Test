<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaterWorks - Start</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Gothic&display=swap" rel="stylesheet">
<style>
    /* Global styles */
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: white;
        background-color: #000000;
    }

    /* --- THEME VARIABLES --- */
    :root {
        --form-width: 340px;
        --theme-accent-blue: #00bfff;
        --box-color-themed: rgba(15, 25, 50, 0.85);
        --input-color-themed: rgba(10, 20, 40, 0.9);
        --text-color-primary: #ffffff;
        --text-color-secondary: rgba(255, 255, 255, 0.7);
    }
    
    #page-wrap {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        z-index: 1;
        background-color: #000;
    }

    #liquid-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #fullwidth-media video {
        position: absolute;
        width: 1px;
        height: 1px;
        opacity: 0;
        pointer-events: none;
        z-index: -1;
        object-fit: cover;
    }

    .no-webgl #page-wrap { display: none; }
    .no-webgl #fallback-video-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 0;
    }
    .no-webgl #fallback-video {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Start Screen UI Container */
    .start-screen-ui {
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 20px;
        width: 90%;
        max-width: 600px;
        font-family: 'League Gothic', sans-serif;
        pointer-events: none;
    }
    
    .start-screen-ui .difficulty-label,
    .start-screen-ui .mode-text,
    .start-screen-ui .start-button {
        pointer-events: auto;
    }

    h1.ml15 {
        font-size: clamp(10em, 14vw, 14em);
        margin-bottom: 1px;
        text-transform: uppercase;
        letter-spacing: 0px;
        text-shadow: 3px 3px 10px rgba(0,0,0,0.7);
        color: var(--text-color-primary);
        font-weight: normal;
        white-space: nowrap;
    }

    .ml15 .word { display: inline-block; line-height: 1em; margin: 0 -3px; }
    .difficulty-label { font-family: 'League Gothic', sans-serif; font-size: clamp(1.8em, 4.5vw, 2.6em); text-transform: uppercase; letter-spacing: 3.5px; color: var(--text-color-primary); margin-top: 0px; margin-bottom: 8px; opacity: 0; text-shadow: 1px 1px 4px rgba(0,0,0,0.4); }
    .mode-select { margin-top: 0px; margin-bottom: 15px; display: flex; gap: clamp(10px, 1.8vw, 15px); justify-content: center; opacity: 0; }
    .mode-text { font-size: clamp(1.5em, 3.5vw, 2.2em); text-transform: uppercase; letter-spacing: 2.5px; cursor: pointer; color: #dddddd; opacity: 0.75; transition: opacity 0.3s ease, color 0.3s ease, transform 0.2s ease; text-shadow: 2px 2px 6px rgba(0,0,0,0.5); }
    .mode-text:hover { opacity: 1; color: var(--text-color-primary); transform: scale(1.05); }
    .mode-text.active { opacity: 1; color: var(--theme-accent-blue); transform: scale(1.1); text-shadow: 0 0 10px var(--theme-accent-blue), 2px 2px 6px rgba(0,0,0,0.5); }
    .start-button { display: inline-block; padding: 6px 18px; font-size: clamp(1.3em, 3vw, 1.8em); text-transform: uppercase; text-decoration: none; color: var(--text-color-primary); background-color: transparent; border: 2px solid var(--text-color-primary); border-radius: 6px; letter-spacing: 2px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer; position: relative; overflow: hidden; z-index: 0; transition: color 0.4s ease-in-out, border-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, text-shadow 0.4s ease-in-out; text-shadow: none; opacity: 0; margin-top: 5px; }
    .start-button::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 191, 255, 0.7); transform: scaleY(0); transform-origin: bottom; transition: transform 0.4s cubic-bezier(0.7, 0, 0.2, 1); z-index: -1; }
    .start-button:hover:not(:disabled) { color: var(--text-color-primary); border-color: var(--theme-accent-blue); transform: translateY(-2px) scale(1.01); box-shadow: 0 5px 12px rgba(0,0,0,0.4); text-shadow: 0 0 5px rgba(255, 255, 255, 0.7), 0 0 10px rgba(0, 191, 255, 0.8), 0 0 18px rgba(0, 191, 255, 0.6); }
    .start-button:hover:not(:disabled)::before { transform: scaleY(1); }
    .start-button:active:not(:disabled) { transform: translateY(0px) scale(1); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    .start-button:disabled { background-color: rgba(204, 204, 204, 0.5); color: #777777; border-color: #777777; cursor: not-allowed; box-shadow: none; transform: none; }
    .start-button:disabled::before { display: none; }

    /* Centered Form Wrapper Style (for both Sign-in and Survey) */
    .form-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 20;
        display: none; /* Initially hidden */
        opacity: 0;
    }

    .form-wrapper .container {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
      background: transparent;
      border-radius: 24px;
      width: auto;
      z-index: 1;
    }
    
    .form-wrapper .container::before {
      content: "";
      position: absolute;
      inset: -15px;
      z-index: -1;
      background: conic-gradient(from 90deg, transparent 75%, var(--theme-accent-blue), transparent 100%);
      animation: spin 4s linear infinite;
      border-radius: inherit;
    }

    @keyframes spin { 100% { transform: rotate(450deg); } }

    .login-box, .survey-box {
      background: var(--box-color-themed);
      border-radius: 22px;
      padding: 30px 40px;
      position: relative;
      z-index: 2;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0px 0px 25px rgba(0, 191, 255, 0.15), 0px 0px 10px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
    }

    .login-box { width: var(--form-width); }
    .survey-box { width: 480px; max-height: 90vh; overflow-y: auto; overflow-x: hidden; }
    
    .survey-box::-webkit-scrollbar { width: 8px; }
    .survey-box::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
    .survey-box::-webkit-scrollbar-thumb { background-color: var(--theme-accent-blue); border-radius: 4px; border: 2px solid transparent; background-clip: content-box; }

    .form { display: flex; flex-direction: column; gap: 20px; width: 100%; }
    .header { font-family: 'League Gothic', sans-serif; font-size: 48px; font-weight: normal; color: var(--text-color-primary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; text-shadow: 0 0 10px rgba(0, 191, 255, 0.5); width: 100%; text-align: center; }

    /* --- Form Elements Styling --- */
    .form-group { display: flex; flex-direction: column; gap: 10px; width: 100%; }
    .form-group > label, .footer { font-size: 15px; color: var(--text-color-secondary); font-weight: 500; text-align: left; }
    .input, .form-group select { width: 100%; padding: 12px 16px; background: var(--input-color-themed); color: var(--text-color-primary); border: 1px solid rgba(0, 191, 255, 0.4); border-radius: 8px; font-size: 15px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; outline: none; transition: border-color 0.3s, box-shadow 0.3s; box-sizing: border-box; }
    .input::placeholder { color: var(--text-color-secondary); opacity: 0.7; }
    .input:focus, .form-group select:focus { border-color: var(--theme-accent-blue); box-shadow: 0 0 10px rgba(0, 191, 255, 0.4); }

    /* Button Styling */
    .button { width: 100%; height: 48px; border-radius: 8px; font-family: 'League Gothic', sans-serif; font-size: 18px; text-transform: uppercase; letter-spacing: 1.5px; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: background-color 0.3s, box-shadow 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: none; }
    .button.primary { background-color: var(--theme-accent-blue); color: var(--text-color-primary); margin-top: 5px; }
    .button.primary:hover { background-color: #00a0d8; box-shadow: 0 0 12px rgba(0, 191, 255, 0.6); }
    .button.google-sign-in { background-color: transparent; color: var(--text-color-primary); border: 2px solid var(--theme-accent-blue); gap: 10px; }
    .button.google-sign-in:hover { background-color: rgba(0, 191, 255, 0.15); border-color: #00a0d8; box-shadow: 0 0 10px rgba(0, 191, 255, 0.3); }
    .button.google-sign-in .icon { height: 18px; } .button.google-sign-in .icon path { fill: var(--text-color-primary); }

    /* Footer Links */
    .footer { width: 100%; text-align: center; font-size: 13px; margin-top: auto; padding-top: 15px; }
    .footer .link { color: var(--theme-accent-blue); text-decoration: none; font-weight: 500; transition: color 0.3s, text-shadow 0.3s; cursor: pointer; }
    .footer .link:hover { color: var(--text-color-primary); text-shadow: 0 0 6px var(--theme-accent-blue); }
    
    /* Radio & Checkbox Styling */
    .radio-group, .checkbox-group { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 4px; }
    .radio-group label, .checkbox-group label { display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--text-color-primary); font-size: 14px; }
    .radio-group input[type="radio"], .checkbox-group input[type="checkbox"] { display: none; }
    .radio-custom, .checkbox-custom { border: 2px solid rgba(0, 191, 255, 0.6); transition: border-color 0.3s; display: flex; align-items: center; justify-content: center; }
    .radio-custom { width: 18px; height: 18px; border-radius: 50%; }
    .checkbox-custom { width: 18px; height: 18px; border-radius: 4px; }
    
    .radio-group label:hover .radio-custom, .checkbox-group label:hover .checkbox-custom { border-color: var(--theme-accent-blue); }
    
    input[type="radio"]:checked + .radio-custom, input[type="checkbox"]:checked + .checkbox-custom { border-color: var(--theme-accent-blue); }
    
    input[type="radio"]:checked + .radio-custom::after { content: ''; width: 10px; height: 10px; background: var(--theme-accent-blue); border-radius: 50%; box-shadow: 0 0 5px var(--theme-accent-blue); }
    input[type="checkbox"]:checked + .checkbox-custom::after { content: '✓'; font-size: 14px; font-weight: bold; color: var(--theme-accent-blue); }

    /* Likert Scale Specific Styles */
    .likert-scale-container { display: flex; justify-content: space-between; text-align: center; }
    .likert-scale-container label { flex-direction: column; align-items: center; gap: 8px; font-size: 14px; }
    .likert-label-wrapper { display: flex; justify-content: space-between; margin-top: 4px; }
    .likert-label-wrapper .likert-label { font-size: 12px; color: var(--text-color-secondary); }
    
    .slider-container { display: flex; align-items: center; gap: 15px; }
    input[type="range"] { -webkit-appearance: none; flex-grow: 1; background: transparent; }
    input[type="range"]:focus { outline: none; }
    input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 6px; cursor: pointer; background: var(--input-color-themed); border: 1px solid rgba(0, 191, 255, 0.4); border-radius: 3px; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; border: 2px solid var(--theme-accent-blue); height: 18px; width: 18px; border-radius: 50%; background: var(--box-color-themed); cursor: pointer; margin-top: -7px; transition: background 0.2s, box-shadow 0.2s; }
    input[type="range"]:focus::-webkit-slider-thumb, input[type="range"]::-webkit-slider-thumb:hover { background: var(--theme-accent-blue); box-shadow: 0 0 8px rgba(0, 191, 255, 0.7); }
    #age-value, #usage-percent-value { font-weight: bold; color: var(--theme-accent-blue); min-width: 45px; text-align: center; }
    
    .conditional { display: none; }
    .inline-input { display: inline-block; width: 120px; margin-left: 10px; }

    /* Confirmation Screen Style */
    #survey-confirmation {
        width: 480px;
        background: var(--box-color-themed);
        border-radius: 22px;
        padding: 30px 40px;
        box-sizing: border-box;
        display: none; /* Hidden by default */
        opacity: 0;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        gap: 25px;
    }
    #confirmation-message {
        font-size: 24px;
        color: var(--text-color-primary);
        font-family: 'League Gothic', sans-serif;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        padding: 0 20px;
    }
    #survey-confirmation .button {
        width: auto;
        padding: 10px 30px;
    }
</style>
</head>
<body>
    <!-- Fallback and Canvas -->
    <div id="fallback-video-container" style="display: none;"><video id="fallback-video" autoplay loop muted playsinline crossorigin="anonymous"><source src="https://video.wixstatic.com/video/fa09dd_39489d5824af4248bb6c5c62abd86912/1080p/mp4/file.mp4" type="video/mp4"></video></div>
    <div id="page-wrap"><canvas id="liquid-canvas"></canvas><div id="fullwidth-media"><video data-sampler="displacedImage" id="bg-video-source" src="https://video.wixstatic.com/video/fa09dd_39489d5824af4248bb6c5c62abd86912/1080p/mp4/file.mp4" autoplay loop muted playsinline crossorigin="anonymous"></video></div></div>
    <!-- Start Screen -->
    <div class="start-screen-ui"><h1 class="ml15"><span class="word">W</span><span class="word">A</span><span class="word">T</span><span class="word">E</span><span class="word">R</span><span class="word">W</span><span class="word">O</span><span class="word">R</span><span class="word">K</span><span class="word">S</span></h1><p class="difficulty-label">Difficulty</p><div class="mode-select"><span class="mode-text" data-mode="operator">Intern</span><span class="mode-text" data-mode="manager">Operator</span><span class="mode-text" data-mode="intern">Manager</span></div><a href="#" id="start-game-btn" class="start-button" disabled>Start</a></div>
    <!-- Sign-in Form -->
    <div id="signin-form-wrapper" class="form-wrapper"><div class="container"><div class="login-box"><form class="form"><span class="header">Welcome Back!</span><div class="form-group"><input type="email" placeholder="Email" class="input" /></div><div class="form-group"><input type="password" placeholder="Password" class="input" /></div><button type="submit" class="button primary">Sign In</button><button type="button" class="button google-sign-in"><svg class="icon" viewBox="-3 0 262 262" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><path d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027" fill="#4285F4"></path><path d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1" fill="#34A853"></path><path d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782" fill="#FBBC05"></path><path d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251" fill="#EB4335"></path></svg><span>Sign in with Google</span></button><p class="footer">Don't have an account? <a id="signup-link" class="link">Sign up, it's free!</a><br /><a href="#" class="link">Forgot password?</a></p></form></div></div></div>
    <!-- Survey Form -->
    <div id="survey-form-wrapper" class="form-wrapper"><div class="container"><div class="survey-box"><form class="form" id="user-survey-form"><span class="header">Create Your Account</span><div class="form-group"><label for="username">Username</label><input type="text" id="username" name="username" class="input" placeholder="Choose a username" required></div><div class="form-group"><label for="age">Age: <span id="age-value">40</span></label><div class="slider-container"><input type="range" id="age" name="age" min="13" max="100" value="40" class="slider"></div></div><div class="form-group"><label>Gender</label><div class="radio-group"><label><input type="radio" name="gender" value="male"><span class="radio-custom"></span>Male</label><label><input type="radio" name="gender" value="female"><span class="radio-custom"></span>Female</label><label><input type="radio" name="gender" value="other"><span class="radio-custom"></span>Other</label><label><input type="radio" name="gender" value="prefer_not_to_say"><span class="radio-custom"></span>Prefer not to say</label></div></div><div class="form-group"><label for="education">Education Level</label><select id="education" name="education" class="input"><option value="" disabled selected>Select an option...</option><option value="high_school">High School or equivalent</option><option value="some_college">Some college, no degree</option><option value="associates">Associate degree</option><option value="bachelors">Bachelor’s degree</option><option value="masters">Master’s degree</option><option value="doctorate">Doctorate or professional degree</option><option value="prefer_not_to_say">Prefer not to say</option></select></div><div class="form-group"><label for="income">Annual Household Income</label><select id="income" name="income" class="input"><option value="" disabled selected>Select a range...</option><option value="<25k">Less than $25,000</option><option value="25k-50k">$25,000 to $49,999</option><option value="50k-75k">$50,000 to $74,999</option><option value="75k-100k">$75,000 to $99,999</option><option value="100k-150k">$100,000 to $149,999</option><option value=">150k">$150,000 or more</option><option value="prefer_not_to_say">Prefer not to say</option></select></div><div class="form-group"><label for="household_size">How many people usually live in your household?</label><input type="number" id="household_size" name="household_size" class="input" min="1" placeholder="e.g., 4"></div><div class="form-group"><label>Are you a U.S. Resident?</label><div class="radio-group"><label><input type="radio" name="us_resident" value="yes"><span class="radio-custom"></span>Yes</label><label><input type="radio" name="us_resident" value="no"><span class="radio-custom"></span>No</label></div></div><div id="state-question" class="form-group conditional"><label for="state">State</label><select id="state" name="state" class="input"></select></div><div id="martin-county-question" class="form-group conditional"><label>Are you a Resident of Martin County, KY?</label><div class="radio-group"><label><input type="radio" name="martin_county_resident" value="yes"><span class="radio-custom"></span>Yes</label><label><input type="radio" name="martin_county_resident" value="no"><span class="radio-custom"></span>No</label></div></div><div class="form-group"><label for="water_source">What is your primary Drinking Water Source?</label><div class="radio-group"><label><input type="radio" name="water_source" value="bottled"><span class="radio-custom"></span>Bottled</label><label><input type="radio" name="water_source" value="tap"><span class="radio-custom"></span>Tap</label><label><input type="radio" name="water_source" value="well"><span class="radio-custom"></span>Well</label><label><input type="radio" name="water_source" value="other"><span class="radio-custom"></span>Other</label><div id="other-water-source-container" class="conditional"><input type="text" id="other_water_source" name="other_water_source" class="input inline-input" placeholder="Please specify"></div></div></div><div id="bottled-water-question" class="form-group conditional"><label for="bottled_cases">How many cases of bottled water do you consume per week?</label><input type="number" id="bottled_cases" name="bottled_cases" class="input" min="0" placeholder="e.g., 2"></div><div class="form-group"><label>How much was your water bill last month?</label><div class="radio-group" id="water-bill-options"><label><input type="radio" name="water_bill" value="<25"><span class="radio-custom"></span>Less than $25</label><label><input type="radio" name="water_bill" value="25-50"><span class="radio-custom"></span>$25 - $50</label><label><input type="radio" name="water_bill" value="51-100"><span class="radio-custom"></span>$51 - $100</label><label><input type="radio" name="water_bill" value=">100"><span class="radio-custom"></span>More than $100</label><label><input type="radio" name="water_bill" value="exact_amount"><span class="radio-custom"></span>I know the exact amount</label></div></div><div id="water-bill-exact-container" class="form-group conditional"><label for="water_bill_exact">Enter exact amount:</label><input type="number" id="water_bill_exact" name="water_bill_exact" class="input" placeholder="$ amount"><label>How confident are you that this number is accurate?</label><div class="radio-group"><label><input type="radio" name="bill_accuracy" value="very"><span class="radio-custom"></span>Very</label><label><input type="radio" name="bill_accuracy" value="somewhat"><span class="radio-custom"></span>Somewhat</label><label><input type="radio" name="bill_accuracy" value="not_very"><span class="radio-custom"></span>Not very</label><label><input type="radio" name="bill_accuracy" value="not_at_all"><span class="radio-custom"></span>Not at all</label></div></div><div class="form-group"><label>Saving water is important to me, even if it costs more.</label><div class="likert-scale-container"><label><span>1</span><input type="radio" name="saving_importance" value="1"><span class="radio-custom"></span></label><label><span>2</span><input type="radio" name="saving_importance" value="2"><span class="radio-custom"></span></label><label><span>3</span><input type="radio" name="saving_importance" value="3"><span class="radio-custom"></span></label><label><span>4</span><input type="radio" name="saving_importance" value="4"><span class="radio-custom"></span></label><label><span>5</span><input type="radio" name="saving_importance" value="5"><span class="radio-custom"></span></label></div><div class="likert-label-wrapper"><span class="likert-label">Strongly Disagree</span><span class="likert-label">Strongly Agree</span></div></div><div class="form-group"><label>Imagine your water bill were 50% higher every month. Would your total water use...</label><div class="radio-group"><label><input type="radio" name="usage_change" value="decrease"><span class="radio-custom"></span>Decrease</label><label><input type="radio" name="usage_change" value="stay_same"><span class="radio-custom"></span>Stay the same</label><label><input type="radio" name="usage_change" value="increase"><span class="radio-custom"></span>Increase</label></div></div><div id="usage-change-percent-question" class="form-group conditional"><label for="usage_change_percent">By roughly what percent? <span id="usage-percent-value">0%</span></label><div class="slider-container"><input type="range" id="usage_change_percent" name="usage_change_percent" min="0" max="100" value="0" class="slider"></div></div><div id="activity-change-question" class="form-group conditional"><label id="activity-change-label"></label><div class="checkbox-group"><label><input type="checkbox" name="activity_change" value="showering"><span class="checkbox-custom"></span>Showering</label><label><input type="checkbox" name="activity_change" value="laundry"><span class="checkbox-custom"></span>Laundry</label><label><input type="checkbox" name="activity_change" value="car_washing"><span class="checkbox-custom"></span>Car Washing</label><label><input type="checkbox" name="activity_change" value="recreation"><span class="checkbox-custom"></span>Pool/Recreation</label><label><input type="checkbox" name="activity_change" value="watering"><span class="checkbox-custom"></span>Watering Plants/Lawn</label><label><input type="checkbox" name="activity_change" value="drinking"><span class="checkbox-custom"></span>Drinking</label></div></div><button type="submit" class="button primary">Complete Sign Up</button></form></div><div id="survey-confirmation"><span id="confirmation-message"></span><button id="continue-to-game-btn" class="button primary">Continue to Game</button></div></div></div>

    <!-- Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
    <!-- Shader Scripts -->
    <script type="x-shader/x-fragment" id="vertShader">precision highp float;varying vec2 vUv;attribute vec2 a_position;varying vec2 vL;varying vec2 vR;varying vec2 vT;varying vec2 vB;uniform vec2 u_texel;void main(){vUv=.5*(a_position+1.);vL=vUv-vec2(u_texel.x,0.);vR=vUv+vec2(u_texel.x,0.);vT=vUv+vec2(0.,u_texel.y);vB=vUv-vec2(0.,u_texel.y);gl_Position=vec4(a_position,0.,1.);}</script><script type="x-shader/x-fragment" id="fragShaderAdvection">precision highp float;precision highp sampler2D;varying vec2 vUv;uniform sampler2D u_velocity_texture;uniform sampler2D u_input_texture;uniform vec2 u_texel;uniform vec2 u_output_textel;uniform float u_dt;uniform float u_dissipation;vec4 bilerp(sampler2D sam,vec2 uv,vec2 tsize){vec2 st=uv/tsize-0.5;vec2 iuv=floor(st);vec2 fuv=fract(st);vec4 a=texture2D(sam,(iuv+vec2(0.5,0.5))*tsize);vec4 b=texture2D(sam,(iuv+vec2(1.5,0.5))*tsize);vec4 c=texture2D(sam,(iuv+vec2(0.5,1.5))*tsize);vec4 d=texture2D(sam,(iuv+vec2(1.5,1.5))*tsize);return mix(mix(a,b,fuv.x),mix(c,d,fuv.x),fuv.y);}void main(){vec2 coord=vUv-u_dt*bilerp(u_velocity_texture,vUv,u_texel).xy*u_texel;vec4 velocity=bilerp(u_input_texture,coord,u_output_textel);gl_FragColor=u_dissipation*velocity;}</script><script type="x-shader/x-fragment" id="fragShaderDivergence">precision highp float;precision highp sampler2D;varying highp vec2 vUv;varying highp vec2 vL;varying highp vec2 vR;varying highp vec2 vT;varying highp vec2 vB;uniform sampler2D u_velocity_texture;void main(){float L=texture2D(u_velocity_texture,vL).x;float R=texture2D(u_velocity_texture,vR).x;float T=texture2D(u_velocity_texture,vT).y;float B=texture2D(u_velocity_texture,vB).y;float div=.25*(R-L+T-B);gl_FragColor=vec4(div,0.,0.,1.);}</script><script type="x-shader/x-fragment" id="fragShaderPressure">precision highp float;precision highp sampler2D;varying highp vec2 vUv;varying highp vec2 vL;varying highp vec2 vR;varying highp vec2 vT;varying highp vec2 vB;uniform sampler2D u_pressure_texture;uniform sampler2D u_divergence_texture;void main(){float L=texture2D(u_pressure_texture,vL).x;float R=texture2D(u_pressure_texture,vR).x;float T=texture2D(u_pressure_texture,vT).x;float B=texture2D(u_pressure_texture,vB).x;float divergence=texture2D(u_divergence_texture,vUv).x;float pressure=(L+R+B+T-divergence)*.25;gl_FragColor=vec4(pressure,0.,0.,1.);}</script><script type="x-shader/x-fragment" id="fragShaderGradientSubtract">precision highp float;precision highp sampler2D;varying highp vec2 vUv;varying highp vec2 vL;varying highp vec2 vR;varying highp vec2 vT;varying highp vec2 vB;uniform sampler2D u_pressure_texture;uniform sampler2D u_velocity_texture;void main(){float L=texture2D(u_pressure_texture,vL).x;float R=texture2D(u_pressure_texture,vR).x;float T=texture2D(u_pressure_texture,vT).x;float B=texture2D(u_pressure_texture,vB).x;vec2 velocity=texture2D(u_velocity_texture,vUv).xy;velocity.xy-=vec2(R-L,T-B);gl_FragColor=vec4(velocity,0.,1.);}</script><script type="x-shader/x-fragment" id="fragShaderPoint">precision highp float;precision highp sampler2D;varying vec2 vUv;uniform sampler2D u_input_texture;uniform float u_ratio;uniform vec3 u_point_value;uniform vec2 u_point;uniform float u_point_size;void main(){vec2 p=vUv-u_point.xy;p.x*=u_ratio;vec3 splat=.6*pow(2.,-dot(p,p)/u_point_size)*u_point_value;vec3 base=texture2D(u_input_texture,vUv).xyz;gl_FragColor=vec4(base+splat,1.);}</script><script type="x-shader/x-fragment" id="fragShaderOutputShader">precision highp float;precision highp sampler2D;varying vec2 vUv;uniform float u_ratio;uniform float u_video_ratio;uniform float u_disturb_power;uniform sampler2D u_output_texture;uniform sampler2D u_velocity_texture;uniform sampler2D u_video_source_texture;vec2 get_video_uv(){vec2 video_uv=vUv;video_uv-=.5;if(u_ratio>u_video_ratio){video_uv.y=video_uv.y*u_ratio/u_video_ratio;}else{video_uv.x=video_uv.x*u_video_ratio/u_ratio;}video_uv*=.95;video_uv+=.5;return video_uv;}vec2 clamp_uv(vec2 uv){return clamp(uv,0.,1.);}void main(){float fluid_offset_strength=texture2D(u_output_texture,vUv).r;vec2 fluid_velocity=texture2D(u_velocity_texture,vUv).xy;vec2 video_uv=get_video_uv();if(length(fluid_velocity)>0.){video_uv-=u_disturb_power*normalize(fluid_velocity)*fluid_offset_strength;}vec3 video_color=texture2D(u_video_source_texture,clamp_uv(vec2(video_uv.x,video_uv.y))).rgb;float opacity=1.;gl_FragColor=vec4(video_color,opacity);}</script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBoEzgyT7WaNa_RY0GI5v2QPknkCEQQZ4w",
            authDomain: "waterworks-8f610.firebaseapp.com",
            projectId: "waterworks-8f610",
            storageBucket: "waterworks-8f610.appspot.com",
            messagingSenderId: "276617277742",
            appId: "1:276617277742:web:b8e4dbacdca00524770abf",
            measurementId: "G-XSLD0XE0LS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            // --- UI Elements ---
            const startScreenUI = document.querySelector('.start-screen-ui');
            const modeTexts = document.querySelectorAll('.mode-text');
            const startButton = document.getElementById('start-game-btn');
            const signinFormWrapper = document.getElementById('signin-form-wrapper');
            const surveyFormWrapper = document.getElementById('survey-form-wrapper');
            const signupLink = document.getElementById('signup-link');

            // --- Survey Form and Confirmation Elements ---
            const surveyBox = document.querySelector('#survey-form-wrapper .survey-box');
            const surveyForm = document.getElementById('user-survey-form');
            const surveyConfirmation = document.getElementById('survey-confirmation');
            const confirmationMessage = document.getElementById('confirmation-message');
            const usernameInput = document.getElementById('username');
            const ageSlider = document.getElementById('age');
            const ageValue = document.getElementById('age-value');
            const usResidentRadios = document.querySelectorAll('input[name="us_resident"]');
            const stateQuestionDiv = document.getElementById('state-question');
            const stateSelect = document.getElementById('state');
            const martinCountyQuestionDiv = document.getElementById('martin-county-question');
            const waterBillRadios = document.querySelectorAll('input[name="water_bill"]');
            const waterBillExactContainer = document.getElementById('water-bill-exact-container');
            const waterSourceRadios = document.querySelectorAll('input[name="water_source"]');
            const otherWaterSourceContainer = document.getElementById('other-water-source-container');
            const bottledWaterQuestion = document.getElementById('bottled-water-question');
            const usageChangeRadios = document.querySelectorAll('input[name="usage_change"]');
            const usageChangePercentQuestion = document.getElementById('usage-change-percent-question');
            const usageChangePercentSlider = document.getElementById('usage_change_percent');
            const usagePercentValue = document.getElementById('usage-percent-value');
            const activityChangeQuestion = document.getElementById('activity-change-question');
            const activityChangeLabel = document.getElementById('activity-change-label');

            // --- Initial Animation & UI Flow ---
            let selectedMode = null;
            anime.timeline({loop: false}).add({ targets: '.ml15 .word', scale: [14,1], opacity: [0,1], easing: "easeOutCirc", duration: 800, delay: (el, i) => 100 * i }).add({ targets: ['.difficulty-label', '.mode-select'], opacity: [0, 1], translateY: [10, 0], duration: 600, easing: "easeOutExpo", offset: '-=200' }).add({ targets: '.start-button', opacity: [0, 1], translateY: [10, 0], duration: 600, easing: "easeOutExpo" }, '-=400');
            modeTexts.forEach(text => { text.addEventListener('click', () => { modeTexts.forEach(t => t.classList.remove('active')); text.classList.add('active'); selectedMode = text.getAttribute('data-mode'); startButton.disabled = false; }); });
            startButton.addEventListener('click', (event) => { event.preventDefault(); if (!selectedMode) { alert("Please select a difficulty level first!"); return; } anime({ targets: startScreenUI, opacity: [1, 0], scale: [1, 0.9], duration: 500, easing: 'easeInExpo', complete: () => { startScreenUI.style.display = 'none'; signinFormWrapper.style.display = 'block'; anime({ targets: signinFormWrapper, opacity: [0, 1], translateX: '-50%', translateY: '-50%', scale: [0.95, 1], duration: 600, easing: 'easeOutExpo' }); } }); });
            signupLink.addEventListener('click', (event) => { event.preventDefault(); anime({ targets: signinFormWrapper, opacity: [1, 0], translateX: '-50%', translateY: '-50%', scale: [1, 0.95], duration: 500, easing: 'easeInExpo', complete: () => { signinFormWrapper.style.display = 'none'; surveyFormWrapper.style.display = 'block'; anime({ targets: surveyFormWrapper, opacity: [0, 1], translateX: '-50%', translateY: '-50%', scale: [0.95, 1], duration: 600, easing: 'easeOutExpo' }); } }); });

            // --- Survey Logic ---
            const states = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];
            stateSelect.innerHTML = `<option value="" disabled selected>Select your state...</option>` + states.map(s => `<option value="${s}">${s}</option>`).join('');
            ageSlider.addEventListener('input', () => { ageValue.textContent = ageSlider.value; });
            usageChangePercentSlider.addEventListener('input', () => { usagePercentValue.textContent = usageChangePercentSlider.value + '%'; });
            usResidentRadios.forEach(r => r.addEventListener('change', e => { stateQuestionDiv.style.display = e.target.value === 'yes' ? 'flex' : 'none'; if (e.target.value !== 'yes') { martinCountyQuestionDiv.style.display = 'none'; stateSelect.value = ''; } }));
            stateSelect.addEventListener('change', e => { martinCountyQuestionDiv.style.display = e.target.value === 'Kentucky' ? 'flex' : 'none'; });
            waterBillRadios.forEach(r => r.addEventListener('change', e => { waterBillExactContainer.style.display = e.target.value === 'exact_amount' ? 'flex' : 'none'; }));
            waterSourceRadios.forEach(r => r.addEventListener('change', e => { otherWaterSourceContainer.style.display = e.target.value === 'other' ? 'flex' : 'none'; bottledWaterQuestion.style.display = e.target.value === 'bottled' ? 'flex' : 'none'; }));
            usageChangeRadios.forEach(r => r.addEventListener('change', e => {
                const selection = e.target.value;
                const showQuestions = selection === 'increase' || selection === 'decrease';
                usageChangePercentQuestion.style.display = showQuestions ? 'flex' : 'none';
                activityChangeQuestion.style.display = showQuestions ? 'flex' : 'none';
                if (showQuestions) { activityChangeLabel.textContent = `What activities would you ${selection}?`; }
            }));

            // --- Form Submission with Firestore Integration ---
            surveyForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';

                // Collect form data
                const formData = new FormData(surveyForm);
                const activityChanges = formData.getAll('activity_change');
                const surveyData = Object.fromEntries(formData.entries());
                surveyData.activity_change = activityChanges;
                surveyData.submission_timestamp = serverTimestamp(); // Add a timestamp
                
                try {
                    // Add a new document with a generated ID to the 'surveys' collection.
                    const docRef = await addDoc(collection(db, "surveys"), surveyData);
                    console.log("Document written with ID: ", docRef.id);

                    // Show confirmation screen on success
                    const username = usernameInput.value || "User";
                    confirmationMessage.textContent = `Thank you for your response, ${username}!`;

                    anime({
                        targets: surveyBox, opacity: [1, 0], duration: 400, easing: 'easeOutExpo',
                        complete: () => { surveyBox.style.display = 'none'; }
                    });
                    surveyConfirmation.style.display = 'flex';
                    anime({ targets: surveyConfirmation, opacity: [0, 1], duration: 400, easing: 'easeInExpo', delay: 100 });

                } catch (error) {
                    console.error("Error adding document: ", error);
                    alert("There was an error submitting your survey. Please try again.");
                    submitButton.disabled = false;
                    submitButton.textContent = 'Complete Sign Up';
                }
            });

            // --- WebGL Background Effect (unchanged) ---
            const canvasEl = document.getElementById("liquid-canvas"), videoElement = document.getElementById("bg-video-source"); if (!videoElement) { document.body.classList.add("no-webgl"); document.getElementById('fallback-video-container').style.display = 'flex'; return; } const params = { cursorSize: 2.0, cursorPower: 24.0, distortionPower: 0.03 }, pointer = { x: 0.65 * window.innerWidth, y: 0.5 * window.innerHeight, dx: 0, dy: 0, moved: false }; const res = { w: null, h: null }; let outputColor, velocity, divergence, pressure, videoTextureGL, videoAspectRatio, isPreview = true; const gl = canvasEl.getContext("webgl"); if (!gl) { document.body.classList.add("no-webgl"); document.getElementById('fallback-video-container').style.display = 'flex'; return; } gl.getExtension("OES_texture_float"); const vertexShader=createShader(document.getElementById("vertShader").innerHTML,gl.VERTEX_SHADER),splatProgram=createProgram("fragShaderPoint"),divergenceProgram=createProgram("fragShaderDivergence"),pressureProgram=createProgram("fragShaderPressure"),gradientSubtractProgram=createProgram("fragShaderGradientSubtract"),advectionProgram=createProgram("fragShaderAdvection"),displayProgram=createProgram("fragShaderOutputShader"); function initializeEffect(){resizeCanvas();initFBOs();setupVideoTexture();if(videoElement.readyState>=videoElement.HAVE_ENOUGH_DATA){videoElement.play().catch(e=>console.warn("Video play failed:",e));if(videoElement.videoWidth>0)videoAspectRatio=videoElement.videoWidth/videoElement.videoHeight;render();}else{videoElement.oncanplaythrough=()=>{videoElement.play().catch(e=>console.warn("Video play failed on canplaythrough:",e));if(videoElement.videoWidth>0)videoAspectRatio=videoElement.videoWidth/videoElement.videoHeight;if(!animationFrameId)render();};}setupEvents();} videoElement.onloadedmetadata=()=>{if(videoElement.videoWidth>0)videoAspectRatio=videoElement.videoWidth/videoElement.videoHeight;};if(videoElement.readyState>=videoElement.HAVE_METADATA&&videoElement.videoWidth>0){videoAspectRatio=videoElement.videoWidth/videoElement.videoHeight;} function setupVideoTexture(){videoTextureGL=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,videoTextureGL);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);} function setupEvents(){canvasEl.addEventListener("mousedown",()=>{isPreview=false;});canvasEl.addEventListener("mousemove",(e)=>{isPreview=false;updatePointerPosition(e.pageX,e.pageY);});canvasEl.addEventListener("touchstart",(e)=>{isPreview=false;e.preventDefault();});canvasEl.addEventListener("touchmove",(e)=>{isPreview=false;e.preventDefault();updatePointerPosition(e.targetTouches[0].pageX,e.targetTouches[0].pageY);});} function updatePointerPosition(eX,eY){pointer.moved=true;pointer.dx=6*(eX-pointer.x);pointer.dy=6*(eY-pointer.y);pointer.x=eX;pointer.y=eY;} function createProgram(fragShaderId){const shaderSource=document.getElementById(fragShaderId).innerHTML;const fragmentShader=createShader(shaderSource,gl.FRAGMENT_SHADER);const program=createShaderProgram(vertexShader,fragmentShader);const uniforms=getUniforms(program);return{program,uniforms};} function createShaderProgram(vertexShader,fragmentShader){const program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Shader program link error: "+gl.getProgramInfoLog(program));return null;}return program;} function getUniforms(program){let uniforms={};let uniformCount=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(let i=0;i<uniformCount;i++){let uniformInfo=gl.getActiveUniform(program,i);uniforms[uniformInfo.name]=gl.getUniformLocation(program,uniformInfo.name);}return uniforms;} function createShader(sourceCode,type){const shader=gl.createShader(type);gl.shaderSource(shader,sourceCode);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.error("Shader compile error: "+gl.getShaderInfoLog(shader));gl.deleteShader(shader);return null;}return shader;} function blit(target){gl.bindBuffer(gl.ARRAY_BUFFER,gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,gl.createBuffer());gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),gl.STATIC_DRAW);gl.vertexAttribPointer(0,2,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(0);if(target==null){gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);gl.bindFramebuffer(gl.FRAMEBUFFER,null);}else{gl.viewport(0,0,target.width,target.height);gl.bindFramebuffer(gl.FRAMEBUFFER,target.fbo);}gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);} function initFBOs(){outputColor=createDoubleFBO(res.w,res.h);velocity=createDoubleFBO(res.w,res.h);divergence=createFBO(res.w,res.h);pressure=createDoubleFBO(res.w,res.h);} function createFBO(w,h){gl.activeTexture(gl.TEXTURE0);const texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,w,h,0,gl.RGB,gl.FLOAT,null);const fbo=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,fbo);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);gl.viewport(0,0,w,h);gl.clear(gl.COLOR_BUFFER_BIT);return{fbo,width:w,height:h,attach(id){gl.activeTexture(gl.TEXTURE0+id);gl.bindTexture(gl.TEXTURE_D,texture);return id;}};} function createDoubleFBO(w,h){let fbo1=createFBO(w,h);let fbo2=createFBO(w,h);return{width:w,height:h,texelSizeX:1./w,texelSizeY:1./h,get read(){return fbo1;},get write(){return fbo2;},swap(){let temp=fbo1;fbo1=fbo2;fbo2=temp;}};} let animationFrameId=null;function render(timestamp){const dt=1/60;if(isPreview&&timestamp){updatePointerPosition((.5+.25*Math.sin(.001*timestamp-Math.PI))*window.innerWidth,(.5+.1*Math.sin(.002*timestamp)*Math.cos(.001*timestamp))*window.innerHeight);}if(pointer.moved){if(!isPreview)pointer.moved=false;gl.useProgram(splatProgram.program);gl.uniform1i(splatProgram.uniforms.u_input_texture,velocity.read.attach(1));gl.uniform1f(splatProgram.uniforms.u_ratio,canvasEl.width/canvasEl.height);gl.uniform2f(splatProgram.uniforms.u_point,pointer.x/window.innerWidth,1.-pointer.y/window.innerHeight);gl.uniform3f(splatProgram.uniforms.u_point_value,pointer.dx,-pointer.dy,0.);gl.uniform1f(splatProgram.uniforms.u_point_size,params.cursorSize*.001);blit(velocity.write);velocity.swap();gl.uniform1i(splatProgram.uniforms.u_input_texture,outputColor.read.attach(1));gl.uniform3f(splatProgram.uniforms.u_point_value,params.cursorPower*.001,0.,0.);blit(outputColor.write);outputColor.swap();}gl.useProgram(divergenceProgram.program);gl.uniform2f(divergenceProgram.uniforms.u_texel,velocity.texelSizeX,velocity.texelSizeY);gl.uniform1i(divergenceProgram.uniforms.u_velocity_texture,velocity.read.attach(1));blit(divergence);gl.useProgram(pressureProgram.program);gl.uniform1i(pressureProgram.uniforms.u_divergence_texture,divergence.attach(1));for(let i=0;i<16;i++){gl.uniform1i(pressureProgram.uniforms.u_pressure_texture,pressure.read.attach(2));blit(pressure.write);pressure.swap();}gl.useProgram(gradientSubtractProgram.program);gl.uniform1i(gradientSubtractProgram.uniforms.u_pressure_texture,pressure.read.attach(1));gl.uniform1i(gradientSubtractProgram.uniforms.u_velocity_texture,velocity.read.attach(2));blit(velocity.write);velocity.swap();gl.useProgram(advectionProgram.program);gl.uniform2f(advectionProgram.uniforms.u_texel,velocity.texelSizeX,velocity.texelSizeY);gl.uniform2f(advectionProgram.uniforms.u_output_textel,velocity.texelSizeX,velocity.texelSizeY);gl.uniform1i(advectionProgram.uniforms.u_velocity_texture,velocity.read.attach(1));gl.uniform1i(advectionProgram.uniforms.u_input_texture,velocity.read.attach(1));gl.uniform1f(advectionProgram.uniforms.u_dt,dt);gl.uniform1f(advectionProgram.uniforms.u_dissipation,.97);blit(velocity.write);velocity.swap();gl.uniform2f(advectionProgram.uniforms.u_output_textel,outputColor.texelSizeX,outputColor.texelSizeY);gl.uniform1i(advectionProgram.uniforms.u_input_texture,outputColor.read.attach(2));gl.uniform1f(advectionProgram.uniforms.u_dissipation,.98);blit(outputColor.write);outputColor.swap();if(videoElement.readyState>=videoElement.HAVE_ENOUGH_DATA&&videoTextureGL){gl.activeTexture(gl.TEXTURE0+3);gl.bindTexture(gl.TEXTURE_2D,videoTextureGL);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,videoElement);}gl.useProgram(displayProgram.program);gl.uniform1i(displayProgram.uniforms.u_velocity_texture,velocity.read.attach(2));gl.uniform1f(displayProgram.uniforms.u_ratio,canvasEl.width/canvasEl.height);gl.uniform1f(displayProgram.uniforms.u_video_ratio,videoAspectRatio||(16/9));gl.uniform1f(displayProgram.uniforms.u_disturb_power,params.distortionPower);gl.uniform1i(displayProgram.uniforms.u_output_texture,outputColor.read.attach(1));gl.uniform1i(displayProgram.uniforms.u_video_source_texture,3);blit(null);animationFrameId=requestAnimationFrame(render);} function resizeCanvas(){canvasEl.width=1920;canvasEl.height=1080;const aspectRatio=1920/1080;let styleWidth,styleHeight;if(window.innerWidth/window.innerHeight>aspectRatio){styleWidth=window.innerWidth;styleHeight=window.innerWidth/aspectRatio;}else{styleHeight=window.innerHeight;styleWidth=window.innerHeight*aspectRatio;}canvasEl.style.width=`${styleWidth}px`;canvasEl.style.height=`${styleHeight}px`;canvasEl.style.position='absolute';canvasEl.style.left=`${(window.innerWidth-styleWidth)/2}px`;canvasEl.style.top=`${(window.innerHeight-styleHeight)/2}px`;res.w=Math.floor(1920/3);res.h=Math.floor(1080/3);} window.addEventListener("resize",()=>{resizeCanvas();initFBOs();}); initializeEffect();
        });
    </script>
</body>
</html>